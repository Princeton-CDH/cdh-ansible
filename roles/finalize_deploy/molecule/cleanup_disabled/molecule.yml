---
# Cleanup disabled scenario: Tests that NO cleanup occurs when auto_cleanup_deploys is false
scenario:
  name: cleanup_disabled
  test_sequence:
    # 1. create: Start Docker container for testing
    - create
    # 2. prepare: Set up test environment (create fake deployments)
    - prepare
    # 3. converge: Run the actual finalize_deploy role
    - converge
    # 4. verify: Check that NO cleanup occurred (all deployments remain)
    - verify
    # 5. destroy: Clean up Docker container
    - destroy
# Use Docker to create test containers
driver:
  name: docker

# Define the test environment
platforms:
  - name: instance
    image: quay.io/pulibrary/jammy-ansible:latest
    pre_build_image: true

# Configure how ansible runs our tests
provisioner:
  name: ansible
  config_options:
    defaults:
      host_key_checking: false
  inventory:
    host_vars:
      instance:
        deploy_keep_count: 3                # This value doesn't matter since cleanup is disabled
        auto_cleanup_deploys: false         # DISABLE cleanup functionality (key difference!)
        deploy_user: root                   # Run as root in test container

# Use ansible verifier for verification tests
verifier:
  name: ansible
