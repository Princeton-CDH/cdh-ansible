---
# custom setup tasks file for escriptorium deploy
- name: Customize eScriptorium
  become: true
  tags:
    - setup
    - never
    - escriptorium
  block:
    - name: Install private htr2hpc ssh key
      ansible.builtin.copy:
        src: files/htr2hpc_id_ed25519
        dest: "/home/{{ deploy_user }}/.ssh/htr2hpc_id_ed25519"
        owner: "{{ deploy_user }}"
        group: "{{ deploy_user }}"
        mode: 0600
    - name: Make sure ssh config file exists
      ansible.builtin.file:
        path: "/home/{{ deploy_user }}/.ssh/config"
        mode: 0600
        owner: "{{ deploy_user }}"
        group: "{{ deploy_user }}"
        state: touch
    - name: Configure ssh key for HPC access in ~/.ssh/config
      become: true
      become_user: "{{ deploy_user }}"
      ansible.builtin.blockinfile:
        path: "/home/{{ deploy_user }}/.ssh/config"
        block: |
          Host della
           HostName della.princeton.edu
           IdentityFile ~/.ssh/htr2hpc_id_ed25519

