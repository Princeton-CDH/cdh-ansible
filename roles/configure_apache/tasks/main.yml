---

- name: ensure required packages are present
  become: true
  apt:
    name: ['apache2', 'libapache2-mod-wsgi-py3']
    state: present
    update_cache: true

- name: install apache modules
  become: true
  apache2_module:
    name: "{{ item }}"
    state: present
  notify: restart apache
  with_items:
    - rewrite
    - headers
  #   - expires
  #   - filter
  #   - vhost_alias

- name: Install project apache site config to available sites
  become: true
  template:
    src: "vhosts24.conf.j2"
    dest: "/etc/apache2/sites-available/{{ app_name }}.conf"
  notify: restart apache
 # todo: only restart when file is changed?

- name: Enable project apache site config
  become: true
  file:
    src: "/etc/apache2/sites-available/{{ app_name }}.conf"
    dest: "/etc/apache2/sites-enabled/{{ app_name }}.conf"
    state: link
  # also restart if link is changed?

- name: Remove default site symlink
  become: true
  file:
    path: /etc/apache2/sites-enabled/000-default.conf
    state: absent
