###
# Run django-compressor compress.
#
# This role must come after npm and virtualenv creation, as it depends on both.
# It also create a CACHE dir with the appropriate user and group permissions
# so that Apache can use the result.
###
# Ownership needs to deploy/apache for production
- name: Configure CACHE for django-compressor
  file:
    path: '{{ deploy }}/static/CACHE'
    state: directory
    owner: deploy
    group: apache
    mode: 0771
- name: run ./manage.py compress to build CSS
  django_manage:
    command: compress
    app_path: "{{ deploy }}"
    virtualenv: "{{ deploy }}/env"
