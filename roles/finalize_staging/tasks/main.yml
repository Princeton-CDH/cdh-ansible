###
# This role finalizes the staging VM for use to verify functionality manually
# in Vagrant.
#
# Its main purpose currently is to install a super user with a password since
# Princeton CAS does not work correctly when run through Apache on Vagrant
# (the server does not report its IP as 'localhost' or a princeton.edu domain
# and therefore fails to validate).
###
- block:
    - name: Add a django superuser since CAS won't work behind Vagrant forward
      django_manage:
        command: "loaddata /vagrant/admin_user.json"
        app_path: "{{ deploy }}"
        virtualenv: "{{ deploy }}/env"
  rescue:
    - include_tasks: roles/create_deployment/tasks/fail.yml
