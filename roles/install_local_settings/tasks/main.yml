###
# Install local_settings.py from project repository and add hidden variables
# variables in the template will be references and defined against vars
# that should appear in group_vars/ for the particular project
#
###
- name: Install local_settings.py from project template
  template:
    src: 'templates/{{ group_name }}/local_settings.py'
    dest: '{{ deploy }}/{{ django_app }}/local_settings.py'
- name: Set permissions on local_settings to be unreadable by other
  file:
    path: '{{ deploy }}/{{ django_app }}/local_settings.py'
    mode: u+rw,g+r,o-rwx
- name: For QA, setfacl so that the Django project group can read it too
  acl:
    path: '{{ deploy }}/{{ django_app }}/local_settings.py'
    entity: '{{ project_user }}'
    etype: group
    permissions: r
    state: present
  when: group_name | regex_search('_qa$')
